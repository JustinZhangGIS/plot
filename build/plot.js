function expose(){var t=window.P;P.noConflict=function(){return window.P=t,this},window.P=P}var P={version:"1.0.0"};"object"==typeof module&&"object"==typeof module.exports?module.exports=P:"function"==typeof define&&define.amd&&define(P),"undefined"!=typeof window&&expose(),P.Constants={TWO_PI:2*Math.PI,HALF_PI:Math.PI/2,FITTING_COUNT:100,ZERO_TOLERANCE:1e-4},P.Utils={_stampId:0},P.Utils.trim=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},P.Utils.stamp=function(t){var o="_p_id_";return t[o]=t[o]||this._stampId++,t[o]},P.DomUtils={},P.DomUtils.create=function(t,o,i,e){var s=document.createElement(t);return s.className=o||"",e&&(s.id=e),i&&i.appendChild(s),s},P.DomUtils.createHidden=function(t,o,i){var e=document.createElement(t);return e.style.display="none",i&&(e.id=i),o&&o.appendChild(e),e},P.DomUtils.remove=function(t,o){o&&t&&o.removeChild(t)},P.DomUtils.get=function(t){return document.getElementById(t)},P.DomUtils.getStyle=function(t,o){var i=t.style[o];return"auto"===i?null:i},P.DomUtils.hasClass=function(t,o){return t.className.length>0&&new RegExp("(^|\\s)"+o+"(\\s|$)").test(t.className)},P.DomUtils.addClass=function(t,o){this.hasClass(t,o)||(t.className&&(t.className+=" "),t.className+=o)},P.DomUtils.removeClass=function(t,o){t.className=P.Utils.trim((" "+t.className+" ").replace(" "+o+" "," "))},P.DomUtils.getDomEventKey=function(t,o,i){return"_p_dom_event_"+t+"_"+P.Utils.stamp(o)+(i?"_"+P.Utils.stamp(i):"")},P.DomUtils.addListener=function(t,o,i,e){var s=this,n=P.DomUtils.getDomEventKey(o,i,e),r=t[n];return r?s:(r=function(o){return i.call(e||t,o)},"addEventListener"in t?t.addEventListener(o,r,!1):"attachEvent"in t&&t.attachEvent("on"+o,r),t[n]=r,s)},P.DomUtils.removeListener=function(t,o,i,e){var s=this,n=P.DomUtils.getDomEventKey(o,i,e),r=t[n];return r?("removeEventListener"in t?t.removeEventListener(o,r,!1):"detachEvent"in t&&t.detachEvent("on"+o,r),t[n]=null,s):s},P.PlotTypes={ARC:"arc",ELLIPSE:"ellipse",CURVE:"curve",CLOSED_CURVE:"closedcurve",LUNE:"lune",SECTOR:"sector",GATHERING_PLACE:"gatheringplace",STRAIGHT_ARROW:"straightarrow",ASSAULT_DIRECTION:"assaultdirection",ATTACK_ARROW:"attackarrow",TAILED_ATTACK_ARROW:"tailedattackarrow",SQUAD_COMBAT:"squadcombat",TAILED_SQUAD_COMBAT:"tailedsquadcombat",FINE_ARROW:"finearrow",CIRCLE:"circle",DOUBLE_ARROW:"doublearrow",POLYLINE:"polyline",FREEHAND_LINE:"freehandline",POLYGON:"polygon",FREEHAND_POLYGON:"freehandpolygon",RECTANGLE:"rectangle",MARKER:"marker",TRIANGLE:"triangle"},P.PlotUtils={},P.PlotUtils.distance=function(t,o){return Math.sqrt(Math.pow(t[0]-o[0],2)+Math.pow(t[1]-o[1],2))},P.PlotUtils.wholeDistance=function(t){for(var o=0,i=0;i<t.length-1;i++)o+=P.PlotUtils.distance(t[i],t[i+1]);return o},P.PlotUtils.getBaseLength=function(t){return Math.pow(P.PlotUtils.wholeDistance(t),.99)},P.PlotUtils.mid=function(t,o){return[(t[0]+o[0])/2,(t[1]+o[1])/2]},P.PlotUtils.getCircleCenterOfThreePoints=function(t,o,i){var e=[(t[0]+o[0])/2,(t[1]+o[1])/2],s=[e[0]-t[1]+o[1],e[1]+t[0]-o[0]],n=[(t[0]+i[0])/2,(t[1]+i[1])/2],r=[n[0]-t[1]+i[1],n[1]+t[0]-i[0]];return P.PlotUtils.getIntersectPoint(e,s,n,r)},P.PlotUtils.getIntersectPoint=function(t,o,i,e){if(t[1]==o[1]){var s=(e[0]-i[0])/(e[1]-i[1]),n=s*(t[1]-i[1])+i[0],P=t[1];return[n,P]}if(i[1]==e[1]){var r=(o[0]-t[0])/(o[1]-t[1]);return n=r*(i[1]-t[1])+t[0],P=i[1],[n,P]}return r=(o[0]-t[0])/(o[1]-t[1]),s=(e[0]-i[0])/(e[1]-i[1]),P=(r*t[1]-t[0]-s*i[1]+i[0])/(r-s),n=r*P-r*t[1]+t[0],[n,P]},P.PlotUtils.getAzimuth=function(t,o){var i,e=Math.asin(Math.abs(o[1]-t[1])/P.PlotUtils.distance(t,o));return o[1]>=t[1]&&o[0]>=t[0]?i=e+Math.PI:o[1]>=t[1]&&o[0]<t[0]?i=P.Constants.TWO_PI-e:o[1]<t[1]&&o[0]<t[0]?i=e:o[1]<t[1]&&o[0]>=t[0]&&(i=Math.PI-e),i},P.PlotUtils.getAngleOfThreePoints=function(t,o,i){var e=P.PlotUtils.getAzimuth(o,t)-P.PlotUtils.getAzimuth(o,i);return 0>e?e+P.Constants.TWO_PI:e},P.PlotUtils.isClockWise=function(t,o,i){return(i[1]-t[1])*(o[0]-t[0])>(o[1]-t[1])*(i[0]-t[0])},P.PlotUtils.getPointOnLine=function(t,o,i){var e=o[0]+t*(i[0]-o[0]),s=o[1]+t*(i[1]-o[1]);return[e,s]},P.PlotUtils.getCubicValue=function(t,o,i,e,s){t=Math.max(Math.min(t,1),0);var n=1-t,P=t*t,r=P*t,l=n*n,a=l*n,h=a*o[0]+3*l*t*i[0]+3*n*P*e[0]+r*s[0],p=a*o[1]+3*l*t*i[1]+3*n*P*e[1]+r*s[1];return[h,p]},P.PlotUtils.getThirdPoint=function(t,o,i,e,s){var n=P.PlotUtils.getAzimuth(t,o),r=s?n+i:n-i,l=e*Math.cos(r),a=e*Math.sin(r);return[o[0]+l,o[1]+a]},P.PlotUtils.getArcPoints=function(t,o,i,e){var s,n,r=[],l=e-i;l=0>l?l+P.Constants.TWO_PI:l;for(var a=0;a<=P.Constants.FITTING_COUNT;a++){var h=i+l*a/P.Constants.FITTING_COUNT;s=t[0]+o*Math.cos(h),n=t[1]+o*Math.sin(h),r.push([s,n])}return r},P.PlotUtils.getBisectorNormals=function(t,o,i,e){var s=P.PlotUtils.getNormal(o,i,e),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]),r=s[0]/n,l=s[1]/n,a=P.PlotUtils.distance(o,i),h=P.PlotUtils.distance(i,e);if(n>P.Constants.ZERO_TOLERANCE)if(P.PlotUtils.isClockWise(o,i,e)){var p=t*a,c=i[0]-p*l,g=i[1]+p*r,u=[c,g];p=t*h,c=i[0]+p*l,g=i[1]-p*r;var d=[c,g]}else p=t*a,c=i[0]+p*l,g=i[1]-p*r,u=[c,g],p=t*h,c=i[0]-p*l,g=i[1]+p*r,d=[c,g];else c=i[0]+t*(o[0]-i[0]),g=i[1]+t*(o[1]-i[1]),u=[c,g],c=i[0]+t*(e[0]-i[0]),g=i[1]+t*(e[1]-i[1]),d=[c,g];return[u,d]},P.PlotUtils.getNormal=function(t,o,i){var e=t[0]-o[0],s=t[1]-o[1],n=Math.sqrt(e*e+s*s);e/=n,s/=n;var P=i[0]-o[0],r=i[1]-o[1],l=Math.sqrt(P*P+r*r);P/=l,r/=l;var a=e+P,h=s+r;return[a,h]},P.PlotUtils.getCurvePoints=function(t,o){for(var i=P.PlotUtils.getLeftMostControlPoint(o),e=[i],s=0;s<o.length-2;s++){var n=o[s],r=o[s+1],l=o[s+2],a=P.PlotUtils.getBisectorNormals(t,n,r,l);e=e.concat(a)}var h=P.PlotUtils.getRightMostControlPoint(o);e.push(h);var p=[];for(s=0;s<o.length-1;s++){n=o[s],r=o[s+1],p.push(n);for(var t=0;t<P.Constants.FITTING_COUNT;t++){var c=P.PlotUtils.getCubicValue(t/P.Constants.FITTING_COUNT,n,e[2*s],e[2*s+1],r);p.push(c)}p.push(r)}return p},P.PlotUtils.getLeftMostControlPoint=function(o){var i=o[0],e=o[1],s=o[2],n=P.PlotUtils.getBisectorNormals(0,i,e,s),r=n[0],l=P.PlotUtils.getNormal(i,e,s),a=Math.sqrt(l[0]*l[0]+l[1]*l[1]);if(a>P.Constants.ZERO_TOLERANCE)var h=P.PlotUtils.mid(i,e),p=i[0]-h[0],c=i[1]-h[1],g=P.PlotUtils.distance(i,e),u=2/g,d=-u*c,v=u*p,m=d*d-v*v,y=2*d*v,C=v*v-d*d,f=r[0]-h[0],T=r[1]-h[1],U=h[0]+m*f+y*T,E=h[1]+y*f+C*T;else U=i[0]+t*(e[0]-i[0]),E=i[1]+t*(e[1]-i[1]);return[U,E]},P.PlotUtils.getRightMostControlPoint=function(o){var i=o.length,e=o[i-3],s=o[i-2],n=o[i-1],r=P.PlotUtils.getBisectorNormals(0,e,s,n),l=r[1],a=P.PlotUtils.getNormal(e,s,n),h=Math.sqrt(a[0]*a[0]+a[1]*a[1]);if(h>P.Constants.ZERO_TOLERANCE)var p=P.PlotUtils.mid(s,n),c=n[0]-p[0],g=n[1]-p[1],u=P.PlotUtils.distance(s,n),d=2/u,v=-d*g,m=d*c,y=v*v-m*m,C=2*v*m,f=m*m-v*v,T=l[0]-p[0],U=l[1]-p[1],E=p[0]+y*T+C*U,A=p[1]+C*T+f*U;else E=n[0]+t*(s[0]-n[0]),A=n[1]+t*(s[1]-n[1]);return[E,A]},P.PlotUtils.getBezierPoints=function(t){if(t.length<=2)return t;for(var o=[],i=t.length-1,e=0;1>=e;e+=.01){for(var s=y=0,n=0;i>=n;n++){var r=P.PlotUtils.getBinomialFactor(i,n),l=Math.pow(e,n),a=Math.pow(1-e,i-n);s+=r*l*a*t[n][0],y+=r*l*a*t[n][1]}o.push([s,y])}return o.push(t[i]),o},P.PlotUtils.getBinomialFactor=function(t,o){return P.PlotUtils.getFactorial(t)/(P.PlotUtils.getFactorial(o)*P.PlotUtils.getFactorial(t-o))},P.PlotUtils.getFactorial=function(t){if(1>=t)return 1;if(2==t)return 2;if(3==t)return 6;if(4==t)return 24;if(5==t)return 120;for(var o=1,i=1;t>=i;i++)o*=i;return o},P.PlotUtils.getQBSplinePoints=function(t){if(t.length<=2)return t;var o=2,i=[],e=t.length-o-1;i.push(t[0]);for(var s=0;e>=s;s++)for(var n=0;1>=n;n+=.05){for(var r=y=0,l=0;o>=l;l++){var a=P.PlotUtils.getQuadricBSplineFactor(l,n);r+=a*t[s+l][0],y+=a*t[s+l][1]}i.push([r,y])}return i.push(t[t.length-1]),i},P.PlotUtils.getQuadricBSplineFactor=function(t,o){return 0==t?Math.pow(o-1,2)/2:1==t?(-2*Math.pow(o,2)+2*o+1)/2:2==t?Math.pow(o,2)/2:0},P.Event={},P.Event.EventType={},P.Event.EventType.MOUSEMOVE="mousemove",P.Event.EventType.MOUSEUP="mouseup",P.Event.EventType.MOUSEDOWN="mousedown",P.Event.PlotDrawEvent=function(t,o){goog.base(this,t),this.feature=o},goog.inherits(P.Event.PlotDrawEvent,goog.events.Event),P.Event.PlotDrawEvent.DRAW_START="draw_start",P.Event.PlotDrawEvent.DRAW_END="draw_end",P.Plot=function(t){this.setPoints(t)},P.Plot.prototype={isPlot:function(){return!0},setPoints:function(t){this.points=t?t:[],this.points.length>=1&&this.generate()},getPoints:function(){return this.points.slice(0)},getPointCount:function(){return this.points.length},updatePoint:function(t,o){o>=0&&o<this.points.length&&(this.points[o]=t,this.generate())},updateLastPoint:function(t){this.updatePoint(t,this.points.length-1)},generate:function(){},finishDrawing:function(){}},P.Plot.Arc=function(t){goog.base(this,[]),this.type=P.PlotTypes.ARC,this.fixPointCount=3,this.setPoints(t)},goog.inherits(P.Plot.Arc,esri.geometry.Polyline),goog.mixin(P.Plot.Arc.prototype,P.Plot.prototype),P.Plot.Arc.prototype.generate=function(){var t=this.getPointCount();if(!(2>t))if(2==t)this.setCoordinates(this.points);else{var o=this.points[0],i=this.points[1],e=this.points[2],s=P.PlotUtils.getCircleCenterOfThreePoints(o,i,e),n=P.PlotUtils.distance(o,s),r=P.PlotUtils.getAzimuth(o,s),l=P.PlotUtils.getAzimuth(i,s);if(P.PlotUtils.isClockWise(o,i,e))var a=l,h=r;else a=r,h=l;this.setCoordinates(P.PlotUtils.getArcPoints(s,n,a,h))}},P.Plot.AttackArrow=function(t){goog.base(this,[]),this.type=P.PlotTypes.ATTACK_ARROW,this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.headTailFactor=.8,this.setPoints(t)},goog.inherits(P.Plot.AttackArrow,esri.geometry.Polygon),goog.mixin(P.Plot.AttackArrow.prototype,P.Plot.prototype),P.Plot.AttackArrow.prototype.generate=function(){if(!(this.getPointCount()<2)){if(2==this.getPointCount())return void this.setCoordinates([this.points]);var t=this.getPoints(),o=t[0],i=t[1];P.PlotUtils.isClockWise(t[0],t[1],t[2])&&(o=t[1],i=t[0]);var e=P.PlotUtils.mid(o,i),s=[e].concat(t.slice(2)),n=this.getArrowHeadPoints(s,o,i),r=n[0],l=n[4],a=P.PlotUtils.distance(o,i)/P.PlotUtils.getBaseLength(s),h=this.getArrowBodyPoints(s,r,l,a),p=h.length,c=[o].concat(h.slice(0,p/2));c.push(r);var g=[i].concat(h.slice(p/2,p));g.push(l),c=P.PlotUtils.getQBSplinePoints(c),g=P.PlotUtils.getQBSplinePoints(g),this.setCoordinates([c.concat(n,g.reverse())])}},P.Plot.AttackArrow.prototype.getArrowHeadPoints=function(t,o,i){var e=P.PlotUtils.getBaseLength(t),s=e*this.headHeightFactor,n=t[t.length-1];e=P.PlotUtils.distance(n,t[t.length-2]);var r=P.PlotUtils.distance(o,i);s>r*this.headTailFactor&&(s=r*this.headTailFactor);var l=s*this.headWidthFactor,a=s*this.neckWidthFactor;s=s>e?e:s;var h=s*this.neckHeightFactor,p=P.PlotUtils.getThirdPoint(t[t.length-2],n,0,s,!0),c=P.PlotUtils.getThirdPoint(t[t.length-2],n,0,h,!0),g=P.PlotUtils.getThirdPoint(n,p,P.Constants.HALF_PI,l,!1),u=P.PlotUtils.getThirdPoint(n,p,P.Constants.HALF_PI,l,!0),d=P.PlotUtils.getThirdPoint(n,c,P.Constants.HALF_PI,a,!1),v=P.PlotUtils.getThirdPoint(n,c,P.Constants.HALF_PI,a,!0);return[d,g,n,u,v]},P.Plot.AttackArrow.prototype.getArrowBodyPoints=function(t,o,i,e){for(var s=P.PlotUtils.wholeDistance(t),n=P.PlotUtils.getBaseLength(t),r=n*e,l=P.PlotUtils.distance(o,i),a=(r-l)/2,h=0,p=[],c=[],g=1;g<t.length-1;g++){var u=P.PlotUtils.getAngleOfThreePoints(t[g-1],t[g],t[g+1])/2;h+=P.PlotUtils.distance(t[g-1],t[g]);var d=(r/2-h/s*a)/Math.sin(u),v=P.PlotUtils.getThirdPoint(t[g-1],t[g],Math.PI-u,d,!0),m=P.PlotUtils.getThirdPoint(t[g-1],t[g],u,d,!1);p.push(v),c.push(m)}return p.concat(c)},P.Plot.SquadCombat=function(t){goog.base(this,[]),this.type=P.PlotTypes.SQUAD_COMBAT,this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.tailWidthFactor=.1,this.setPoints(t)},goog.inherits(P.Plot.SquadCombat,P.Plot.AttackArrow),P.Plot.SquadCombat.prototype.generate=function(){var t=this.getPointCount();if(!(2>t)){var o=this.getPoints(),i=this.getTailPoints(o),e=this.getArrowHeadPoints(o,i[0],i[1]),s=e[0],n=e[4],r=this.getArrowBodyPoints(o,s,n,this.tailWidthFactor),t=r.length,l=[i[0]].concat(r.slice(0,t/2));l.push(s);var a=[i[1]].concat(r.slice(t/2,t));a.push(n),l=P.PlotUtils.getQBSplinePoints(l),a=P.PlotUtils.getQBSplinePoints(a),this.setCoordinates([l.concat(e,a.reverse())])}},P.Plot.SquadCombat.prototype.getTailPoints=function(t){var o=P.PlotUtils.getBaseLength(t),i=o*this.tailWidthFactor,e=P.PlotUtils.getThirdPoint(t[1],t[0],P.Constants.HALF_PI,i,!1),s=P.PlotUtils.getThirdPoint(t[1],t[0],P.Constants.HALF_PI,i,!0);return[e,s]},P.Plot.TailedAttackArrow=function(t){goog.base(this,[]),this.type=P.PlotTypes.TAILED_ATTACK_ARROW,this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.tailWidthFactor=.1,this.headTailFactor=.8,this.swallowTailFactor=1,this.swallowTailPnt=null,this.setPoints(t)},goog.inherits(P.Plot.TailedAttackArrow,P.Plot.AttackArrow),P.Plot.TailedAttackArrow.prototype.generate=function(){var t=this.getPointCount();if(!(2>t)){if(2==this.getPointCount())return void this.setCoordinates([this.points]);var o=this.getPoints(),i=o[0],e=o[1];P.PlotUtils.isClockWise(o[0],o[1],o[2])&&(i=o[1],e=o[0]);var s=P.PlotUtils.mid(i,e),n=[s].concat(o.slice(2)),r=this.getArrowHeadPoints(n,i,e),l=r[0],a=r[4],h=P.PlotUtils.distance(i,e),p=P.PlotUtils.getBaseLength(n),c=p*this.tailWidthFactor*this.swallowTailFactor;this.swallowTailPnt=P.PlotUtils.getThirdPoint(n[1],n[0],0,c,!0);var g=h/p,u=this.getArrowBodyPoints(n,l,a,g),t=u.length,d=[i].concat(u.slice(0,t/2));d.push(l);var v=[e].concat(u.slice(t/2,t));v.push(a),d=P.PlotUtils.getQBSplinePoints(d),v=P.PlotUtils.getQBSplinePoints(v),this.setCoordinates([d.concat(r,v.reverse(),[this.swallowTailPnt,d[0]])])}},P.Plot.TailedSquadCombat=function(t){goog.base(this,[]),this.type=P.PlotTypes.TAILED_SQUAD_COMBAT,this.headHeightFactor=.18,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.tailWidthFactor=.1,this.swallowTailFactor=1,this.swallowTailPnt=null,this.setPoints(t)},goog.inherits(P.Plot.TailedSquadCombat,P.Plot.AttackArrow),P.Plot.TailedSquadCombat.prototype.generate=function(){var t=this.getPointCount();if(!(2>t)){var o=this.getPoints(),i=this.getTailPoints(o),e=this.getArrowHeadPoints(o,i[0],i[2]),s=e[0],n=e[4],r=this.getArrowBodyPoints(o,s,n,this.tailWidthFactor),t=r.length,l=[i[0]].concat(r.slice(0,t/2));l.push(s);var a=[i[2]].concat(r.slice(t/2,t));a.push(n),l=P.PlotUtils.getQBSplinePoints(l),a=P.PlotUtils.getQBSplinePoints(a),this.setCoordinates([l.concat(e,a.reverse(),[i[1],l[0]])])}},P.Plot.TailedSquadCombat.prototype.getTailPoints=function(t){var o=P.PlotUtils.getBaseLength(t),i=o*this.tailWidthFactor,e=P.PlotUtils.getThirdPoint(t[1],t[0],P.Constants.HALF_PI,i,!1),s=P.PlotUtils.getThirdPoint(t[1],t[0],P.Constants.HALF_PI,i,!0),n=i*this.swallowTailFactor,r=P.PlotUtils.getThirdPoint(t[1],t[0],0,n,!0);return[e,r,s]},P.Plot.Circle=function(t){goog.base(this,[]),this.type=P.PlotTypes.CIRCLE,this.fixPointCount=2,this.setPoints(t)},goog.inherits(P.Plot.Circle,esri.geometry.Polygon),goog.mixin(P.Plot.Circle.prototype,P.Plot.prototype),P.Plot.Circle.prototype.generate=function(){var t=this.getPointCount();if(!(2>t)){var o=this.points[0],i=P.PlotUtils.distance(o,this.points[1]);this.setCoordinates([this.generatePoints(o,i)])}},P.Plot.Circle.prototype.generatePoints=function(t,o){for(var i,e,s,n=[],r=0;r<=P.Constants.FITTING_COUNT;r++)s=2*Math.PI*r/P.Constants.FITTING_COUNT,i=t[0]+o*Math.cos(s),e=t[1]+o*Math.sin(s),n.push([i,e]);return n},P.Plot.ClosedCurve=function(t){goog.base(this,[]),this.type=P.PlotTypes.CLOSED_CURVE,this.t=.3,this.setPoints(t)},goog.inherits(P.Plot.ClosedCurve,esri.geometry.Polygon),goog.mixin(P.Plot.ClosedCurve.prototype,P.Plot.prototype),P.Plot.ClosedCurve.prototype.generate=function(){var t=this.getPointCount();if(!(2>t))if(2==t)this.setCoordinates([this.points]);else{var o=this.getPoints();o.push(o[0],o[1]);for(var i=[],e=0;e<o.length-2;e++){var s=P.PlotUtils.getBisectorNormals(this.t,o[e],o[e+1],o[e+2]);i=i.concat(s)}var t=i.length;i=[i[t-1]].concat(i.slice(0,t-1));var n=[];for(e=0;e<o.length-2;e++){var r=o[e],l=o[e+1];n.push(r);for(var a=0;a<=P.Constants.FITTING_COUNT;a++){var h=P.PlotUtils.getCubicValue(a/P.Constants.FITTING_COUNT,r,i[2*e],i[2*e+1],l);n.push(h)}n.push(l)}this.setCoordinates([n])}},P.Plot.Curve=function(t){goog.base(this,[]),this.type=P.PlotTypes.CURVE,this.t=.3,this.setPoints(t)},goog.inherits(P.Plot.Curve,esri.geometry.Polyline),goog.mixin(P.Plot.Curve.prototype,P.Plot.prototype),P.Plot.Curve.prototype.generate=function(){var t=this.getPointCount();2>t||(2==t?this.setCoordinates(this.points):this.setCoordinates(P.PlotUtils.getCurvePoints(this.t,this.points)))},P.Plot.DoubleArrow=function(t){goog.base(this,[]),this.type=P.PlotTypes.DOUBLE_ARROW,this.headHeightFactor=.25,this.headWidthFactor=.3,this.neckHeightFactor=.85,this.neckWidthFactor=.15,this.connPoint=null,this.tempPoint4=null,this.fixPointCount=4,this.setPoints(t)},goog.inherits(P.Plot.DoubleArrow,esri.geometry.Polygon),goog.mixin(P.Plot.DoubleArrow.prototype,P.Plot.prototype),P.Plot.DoubleArrow.prototype.finishDrawing=function(){3==this.getPointCount()&&null!=this.tempPoint4&&this.points.push(this.tempPoint4),null!=this.connPoint&&this.points.push(this.connPoint)},P.Plot.DoubleArrow.prototype.generate=function(){var t=this.getPointCount();if(!(2>t)){if(2==t)return void this.setCoordinates([this.points]);var o=this.points[0],i=this.points[1],e=this.points[2],t=this.getPointCount();3==t?this.tempPoint4=this.getTempPoint4(o,i,e):this.tempPoint4=this.points[3],3==t||4==t?this.connPoint=P.PlotUtils.mid(o,i):this.connPoint=this.points[4];var s,n;P.PlotUtils.isClockWise(o,i,e)?(s=this.getArrowPoints(o,this.connPoint,this.tempPoint4,!1),n=this.getArrowPoints(this.connPoint,i,e,!0)):(s=this.getArrowPoints(i,this.connPoint,e,!1),n=this.getArrowPoints(this.connPoint,o,this.tempPoint4,!0));var r=s.length,l=(r-5)/2,a=s.slice(0,l),h=s.slice(l,l+5),p=s.slice(l+5,r),c=n.slice(0,l),g=n.slice(l,l+5),u=n.slice(l+5,r);c=P.PlotUtils.getBezierPoints(c);var d=P.PlotUtils.getBezierPoints(u.concat(a.slice(1)));p=P.PlotUtils.getBezierPoints(p);var v=c.concat(g,d,h,p);this.setCoordinates([v])}},P.Plot.DoubleArrow.prototype.getArrowPoints=function(t,o,i,e){var s=P.PlotUtils.mid(t,o),n=P.PlotUtils.distance(s,i),r=P.PlotUtils.getThirdPoint(i,s,0,.3*n,!0),l=P.PlotUtils.getThirdPoint(i,s,0,.5*n,!0);r=P.PlotUtils.getThirdPoint(s,r,P.Constants.HALF_PI,n/5,e),l=P.PlotUtils.getThirdPoint(s,l,P.Constants.HALF_PI,n/4,e);var a=[s,r,l,i],h=this.getArrowHeadPoints(a,this.headHeightFactor,this.headWidthFactor,this.neckHeightFactor,this.neckWidthFactor),p=h[0],c=h[4],g=P.PlotUtils.distance(t,o)/P.PlotUtils.getBaseLength(a)/2,u=this.getArrowBodyPoints(a,p,c,g),d=u.length,v=u.slice(0,d/2),m=u.slice(d/2,d);return v.push(p),m.push(c),v=v.reverse(),v.push(o),m=m.reverse(),m.push(t),v.reverse().concat(h,m)},P.Plot.DoubleArrow.prototype.getArrowHeadPoints=function(t,o,i){var e=P.PlotUtils.getBaseLength(t),s=e*this.headHeightFactor,n=t[t.length-1],r=(P.PlotUtils.distance(o,i),s*this.headWidthFactor),l=s*this.neckWidthFactor,a=s*this.neckHeightFactor,h=P.PlotUtils.getThirdPoint(t[t.length-2],n,0,s,!0),p=P.PlotUtils.getThirdPoint(t[t.length-2],n,0,a,!0),c=P.PlotUtils.getThirdPoint(n,h,P.Constants.HALF_PI,r,!1),g=P.PlotUtils.getThirdPoint(n,h,P.Constants.HALF_PI,r,!0),u=P.PlotUtils.getThirdPoint(n,p,P.Constants.HALF_PI,l,!1),d=P.PlotUtils.getThirdPoint(n,p,P.Constants.HALF_PI,l,!0);return[u,c,n,g,d]},P.Plot.DoubleArrow.prototype.getArrowBodyPoints=function(t,o,i,e){for(var s=P.PlotUtils.wholeDistance(t),n=P.PlotUtils.getBaseLength(t),r=n*e,l=P.PlotUtils.distance(o,i),a=(r-l)/2,h=0,p=[],c=[],g=1;g<t.length-1;g++){var u=P.PlotUtils.getAngleOfThreePoints(t[g-1],t[g],t[g+1])/2;h+=P.PlotUtils.distance(t[g-1],t[g]);var d=(r/2-h/s*a)/Math.sin(u),v=P.PlotUtils.getThirdPoint(t[g-1],t[g],Math.PI-u,d,!0),m=P.PlotUtils.getThirdPoint(t[g-1],t[g],u,d,!1);p.push(v),c.push(m)}return p.concat(c)},P.Plot.DoubleArrow.prototype.getTempPoint4=function(t,o,i){var e,s,n,r,l=P.PlotUtils.mid(t,o),a=P.PlotUtils.distance(l,i),h=P.PlotUtils.getAngleOfThreePoints(t,l,i);return h<P.Constants.HALF_PI?(s=a*Math.sin(h),n=a*Math.cos(h),r=P.PlotUtils.getThirdPoint(t,l,P.Constants.HALF_PI,s,!1),e=P.PlotUtils.getThirdPoint(l,r,P.Constants.HALF_PI,n,!0)):h>=P.Constants.HALF_PI&&h<Math.PI?(s=a*Math.sin(Math.PI-h),n=a*Math.cos(Math.PI-h),r=P.PlotUtils.getThirdPoint(t,l,P.Constants.HALF_PI,s,!1),e=P.PlotUtils.getThirdPoint(l,r,P.Constants.HALF_PI,n,!1)):h>=Math.PI&&h<1.5*Math.PI?(s=a*Math.sin(h-Math.PI),n=a*Math.cos(h-Math.PI),r=P.PlotUtils.getThirdPoint(t,l,P.Constants.HALF_PI,s,!0),e=P.PlotUtils.getThirdPoint(l,r,P.Constants.HALF_PI,n,!0)):(s=a*Math.sin(2*Math.PI-h),n=a*Math.cos(2*Math.PI-h),r=P.PlotUtils.getThirdPoint(t,l,P.Constants.HALF_PI,s,!0),e=P.PlotUtils.getThirdPoint(l,r,P.Constants.HALF_PI,n,!1)),e},P.Plot.Ellipse=function(t){goog.base(this,[]),this.type=P.PlotTypes.ELLIPSE,this.fixPointCount=2,this.setPoints(t)},goog.inherits(P.Plot.Ellipse,esri.geometry.Polygon),goog.mixin(P.Plot.Ellipse.prototype,P.Plot.prototype),P.Plot.Ellipse.prototype.generate=function(){var t=this.getPointCount();if(!(2>t)){var o=this.points[0],i=this.points[1],e=P.PlotUtils.mid(o,i),s=Math.abs((o[0]-i[0])/2),n=Math.abs((o[1]-i[1])/2);this.setCoordinates([this.generatePoints(e,s,n)])}},P.Plot.Ellipse.prototype.generatePoints=function(t,o,i){for(var e,s,n,r=[],l=0;l<=P.Constants.FITTING_COUNT;l++)n=2*Math.PI*l/P.Constants.FITTING_COUNT,e=t[0]+o*Math.cos(n),s=t[1]+i*Math.sin(n),r.push([e,s]);return r},P.Plot.FineArrow=function(t){goog.base(this,[]),this.type=P.PlotTypes.FINE_ARROW,this.tailWidthFactor=.15,this.neckWidthFactor=.2,this.headWidthFactor=.25,this.headAngle=Math.PI/8.5,this.neckAngle=Math.PI/13,this.fixPointCount=2,this.setPoints(t)},goog.inherits(P.Plot.FineArrow,esri.geometry.Polygon),goog.mixin(P.Plot.FineArrow.prototype,P.Plot.prototype),P.Plot.FineArrow.prototype.generate=function(){var t=this.getPointCount();if(!(2>t)){var o=this.getPoints(),i=o[0],e=o[1],s=P.PlotUtils.getBaseLength(o),n=s*this.tailWidthFactor,r=s*this.neckWidthFactor,l=s*this.headWidthFactor,a=P.PlotUtils.getThirdPoint(e,i,P.Constants.HALF_PI,n,!0),h=P.PlotUtils.getThirdPoint(e,i,P.Constants.HALF_PI,n,!1),p=P.PlotUtils.getThirdPoint(i,e,this.headAngle,l,!1),c=P.PlotUtils.getThirdPoint(i,e,this.headAngle,l,!0),g=P.PlotUtils.getThirdPoint(i,e,this.neckAngle,r,!1),u=P.PlotUtils.getThirdPoint(i,e,this.neckAngle,r,!0),d=[a,g,p,e,c,u,h];this.setCoordinates([d])}},P.Plot.AssaultDirection=function(t){goog.base(this,[]),this.type=P.PlotTypes.ASSAULT_DIRECTION,this.tailWidthFactor=.2,this.neckWidthFactor=.25,this.headWidthFactor=.3,this.headAngle=Math.PI/4,this.neckAngle=.17741*Math.PI,this.setPoints(t)},goog.inherits(P.Plot.AssaultDirection,P.Plot.FineArrow),P.Plot.GatheringPlace=function(t){goog.base(this,[]),this.type=P.PlotTypes.GATHERING_PLACE,this.t=.4,this.fixPointCount=3,this.setPoints(t)},goog.inherits(P.Plot.GatheringPlace,esri.geometry.Polygon),goog.mixin(P.Plot.GatheringPlace.prototype,P.Plot.prototype),P.Plot.GatheringPlace.prototype.generate=function(){var t=this.getPoints();if(!(t.length<2)){if(2==this.getPointCount()){var o=P.PlotUtils.mid(t[0],t[1]),i=P.PlotUtils.distance(t[0],o)/.9,e=P.PlotUtils.getThirdPoint(t[0],o,P.Constants.HALF_PI,i,!0);t=[t[0],e,t[1]]}var o=P.PlotUtils.mid(t[0],t[2]);t.push(o,t[0],t[1]);for(var s=[],n=0;n<t.length-2;n++){var r=t[n],l=t[n+1],a=t[n+2],h=P.PlotUtils.getBisectorNormals(this.t,r,l,a);s=s.concat(h)}var p=s.length;s=[s[p-1]].concat(s.slice(0,p-1));var c=[];for(n=0;n<t.length-2;n++){r=t[n],l=t[n+1],c.push(r);for(var g=0;g<=P.Constants.FITTING_COUNT;g++){var e=P.PlotUtils.getCubicValue(g/P.Constants.FITTING_COUNT,r,s[2*n],s[2*n+1],l);c.push(e)}c.push(l)}this.setCoordinates([c])}},P.Plot.Lune=function(t){goog.base(this,[]),this.type=P.PlotTypes.LUNE,this.fixPointCount=3,this.setPoints(t)},goog.inherits(P.Plot.Lune,esri.geometry.Polygon),goog.mixin(P.Plot.Lune.prototype,P.Plot.prototype),P.Plot.Lune.prototype.generate=function(){if(!(this.getPointCount()<2)){var t=this.getPoints();if(2==this.getPointCount()){var o=P.PlotUtils.mid(t[0],t[1]),i=P.PlotUtils.distance(t[0],o),e=P.PlotUtils.getThirdPoint(t[0],o,P.Constants.HALF_PI,i);t.push(e)}var s=t[0],n=t[1],r=t[2],l=P.PlotUtils.getCircleCenterOfThreePoints(s,n,r),a=P.PlotUtils.distance(s,l),h=P.PlotUtils.getAzimuth(s,l),p=P.PlotUtils.getAzimuth(n,l);if(P.PlotUtils.isClockWise(s,n,r))var c=p,g=h;else c=h,g=p;var t=P.PlotUtils.getArcPoints(l,a,c,g);t.push(t[0]),this.setCoordinates([t])}},P.Plot.Sector=function(t){goog.base(this,[]),this.type=P.PlotTypes.SECTOR,this.fixPointCount=3,this.setPoints(t)},goog.inherits(P.Plot.Sector,esri.geometry.Polygon),goog.mixin(P.Plot.Sector.prototype,P.Plot.prototype),P.Plot.Sector.prototype.generate=function(){if(!(this.getPointCount()<2))if(2==this.getPointCount())this.setCoordinates([this.points]);else{var t=this.getPoints(),o=t[0],i=t[1],e=t[2],s=P.PlotUtils.distance(i,o),n=P.PlotUtils.getAzimuth(i,o),r=P.PlotUtils.getAzimuth(e,o),l=P.PlotUtils.getArcPoints(o,s,n,r);l.push(o,l[0]),this.setCoordinates([l])}},P.Plot.StraightArrow=function(t){goog.base(this,[]),this.type=P.PlotTypes.STRAIGHT_ARROW,this.fixPointCount=2,this.maxArrowLength=3e6,this.arrowLengthScale=5,this.setPoints(t)},goog.inherits(P.Plot.StraightArrow,esri.geometry.Polyline),goog.mixin(P.Plot.StraightArrow.prototype,P.Plot.prototype),P.Plot.StraightArrow.prototype.generate=function(){if(!(this.getPointCount()<2)){var t=this.getPoints(),o=t[0],i=t[1],e=P.PlotUtils.distance(o,i),s=e/this.arrowLengthScale;s=s>this.maxArrowLength?this.maxArrowLength:s;var n=P.PlotUtils.getThirdPoint(o,i,Math.PI/6,s,!1),r=P.PlotUtils.getThirdPoint(o,i,Math.PI/6,s,!0);this.setCoordinates([o,i,n,i,r])}},P.Plot.Polyline=function(t){goog.base(this,[]),this.type=P.PlotTypes.POLYLINE,this.setPoints(t)},goog.inherits(P.Plot.Polyline,esri.geometry.Polyline),goog.mixin(P.Plot.Polyline.prototype,P.Plot.prototype),P.Plot.Polyline.prototype.generate=function(){var t=this.getPointCount();2>t||this.setCoordinates(this.points)},P.Plot.FreehandLine=function(t){goog.base(this,[]),this.type=P.PlotTypes.FREEHAND_LINE,this.freehand=!0,this.setPoints(t)},goog.inherits(P.Plot.FreehandLine,esri.geometry.Polyline),goog.mixin(P.Plot.FreehandLine.prototype,P.Plot.prototype),P.Plot.FreehandLine.prototype.generate=function(){var t=this.getPointCount();2>t||this.setCoordinates(this.points)},P.Plot.Polygon=function(t){goog.base(this,[]),this.type=P.PlotTypes.POLYGON,this.setPoints(t)},goog.inherits(P.Plot.Polygon,esri.geometry.Polygon),goog.mixin(P.Plot.Polygon.prototype,P.Plot.prototype),P.Plot.Polygon.prototype.generate=function(){var t=this.getPointCount();2>t||this.setCoordinates([this.points])},P.Plot.Marker=function(t){goog.base(this,[0,0]),this.type=P.PlotTypes.MARKER,this.fixPointCount=1,this.setPoints(t)},goog.inherits(P.Plot.Marker,esri.geometry.Point),goog.mixin(P.Plot.Marker.prototype,P.Plot.prototype),P.Plot.Marker.prototype.generate=function(){var t=this.points[0];this.setCoordinates(t)},P.Plot.Rectangle=function(t){goog.base(this,[]),this.type=P.PlotTypes.RECTANGLE,this.fixPointCount=2,this.setPoints(t)},goog.inherits(P.Plot.Rectangle,esri.geometry.Polygon),goog.mixin(P.Plot.Rectangle.prototype,P.Plot.prototype),P.Plot.Rectangle.prototype.generate=function(){var t=this.getPointCount();if(!(2>t)){var o=this.points[0],i=this.points[1],e=Math.min(o[0],i[0]),s=Math.max(o[0],i[0]),n=Math.min(o[1],i[1]),P=Math.max(o[1],i[1]),r=[e,P],l=[s,P],a=[s,n],h=[e,n];this.setCoordinates([[r,l,a,h]])}},P.Plot.FreehandPolygon=function(t){goog.base(this,[]),this.type=P.PlotTypes.FREEHAND_POLYGON,this.freehand=!0,this.setPoints(t)},goog.inherits(P.Plot.FreehandPolygon,esri.geometry.Polygon),goog.mixin(P.Plot.FreehandPolygon.prototype,P.Plot.prototype),P.Plot.FreehandPolygon.prototype.generate=function(){var t=this.getPointCount();2>t||this.setCoordinates([this.points])},P.PlotFactory={},P.PlotFactory.createPlot=function(t,o){switch(t){case P.PlotTypes.ARC:return new P.Plot.Arc(o);case P.PlotTypes.ELLIPSE:return new P.Plot.Ellipse(o);case P.PlotTypes.CURVE:return new P.Plot.Curve(o);case P.PlotTypes.CLOSED_CURVE:return new P.Plot.ClosedCurve(o);case P.PlotTypes.LUNE:return new P.Plot.Lune(o);case P.PlotTypes.SECTOR:return new P.Plot.Sector(o);case P.PlotTypes.GATHERING_PLACE:return new P.Plot.GatheringPlace(o);case P.PlotTypes.STRAIGHT_ARROW:return new P.Plot.StraightArrow(o);case P.PlotTypes.ASSAULT_DIRECTION:return new P.Plot.AssaultDirection(o);case P.PlotTypes.ATTACK_ARROW:return new P.Plot.AttackArrow(o);case P.PlotTypes.FINE_ARROW:return new P.Plot.FineArrow(o);case P.PlotTypes.CIRCLE:return new P.Plot.Circle(o);case P.PlotTypes.DOUBLE_ARROW:return new P.Plot.DoubleArrow(o);case P.PlotTypes.TAILED_ATTACK_ARROW:return new P.Plot.TailedAttackArrow(o);case P.PlotTypes.SQUAD_COMBAT:return new P.Plot.SquadCombat(o);case P.PlotTypes.TAILED_SQUAD_COMBAT:return new P.Plot.TailedSquadCombat(o);case P.PlotTypes.FREEHAND_LINE:return new P.Plot.FreehandLine(o);case P.PlotTypes.FREEHAND_POLYGON:return new P.Plot.FreehandPolygon(o);case P.PlotTypes.POLYGON:return new P.Plot.Polygon(o);case P.PlotTypes.MARKER:return new P.Plot.Marker(o);case P.PlotTypes.RECTANGLE:return new P.Plot.Rectangle(o);case P.PlotTypes.POLYLINE:return new P.Plot.Polyline(o)}return null},P.PlotDraw=function(t){this.points=null,this.plot=null,this.feature=null,this.plotType=null,this.plotParams=null,this.mapViewport=null,this.dblClickZoomInteraction=null,this.drawOverlay=new esri.layers.GraphicsLayer,this.setMap(t)},P.PlotDraw.prototype.activate=function(t,o){this.deactivate(),this.deactivateMapTools(),map.on("click",this.mapFirstClickHandler,this),this.plotType=t,this.plotParams=o,this.map.addLayer(this.drawOverlay)},P.PlotDraw.prototype.deactivate=function(){this.disconnectEventHandlers(),this.map.removeLayer(this.drawOverlay),this.drawOverlay.clear(),this.points=[],this.plot=null,this.feature=null,this.plotType=null,this.plotParams=null,this.activateMapTools()},P.PlotDraw.prototype.isDrawing=function(){return null!=this.plotType},P.PlotDraw.prototype.setMap=function(t){this.map=t},P.PlotDraw.prototype.mapFirstClickHandler=function(t){return this.points.push(t.coordinate),this.plot=P.PlotFactory.createPlot(this.plotType,this.points,this.plotParams),this.feature=new ol.Feature(this.plot),this.drawOverlay.add(this.feature),this.map.un("click",this.mapFirstClickHandler,this),this.plot.fixPointCount==this.plot.getPointCount()?void this.mapDoubleClickHandler(t):(this.map.on("click",this.mapNextClickHandler,this),this.plot.freehand||this.map.on("dblclick",this.mapDoubleClickHandler,this),void goog.events.listen(this.mapViewport,P.Event.EventType.MOUSEMOVE,this.mapMouseMoveHandler,!1,this))},P.PlotDraw.prototype.mapMouseMoveHandler=function(t){var o=map.getCoordinateFromPixel([t.offsetX,t.offsetY]);if(!(P.PlotUtils.distance(o,this.points[this.points.length-1])<P.Constants.ZERO_TOLERANCE))if(this.plot.freehand)this.points.push(o),this.plot.setPoints(this.points);else{var i=this.points.concat([o]);this.plot.setPoints(i)}},P.PlotDraw.prototype.mapNextClickHandler=function(t){return!this.plot.freehand&&P.PlotUtils.distance(t.coordinate,this.points[this.points.length-1])<P.Constants.ZERO_TOLERANCE?void 0:(this.points.push(t.coordinate),this.plot.setPoints(this.points),this.plot.fixPointCount==this.plot.getPointCount()?void this.mapDoubleClickHandler(t):void(this.plot&&this.plot.freehand&&this.mapDoubleClickHandler(t)))},P.PlotDraw.prototype.mapDoubleClickHandler=function(t){this.disconnectEventHandlers(),this.plot.finishDrawing(),t.preventDefault(),this.drawEnd()},P.PlotDraw.prototype.disconnectEventHandlers=function(){this.map.un("click",this.mapFirstClickHandler,this),this.map.un("click",this.mapNextClickHandler,this),goog.events.unlisten(this.mapViewport,P.Event.EventType.MOUSEMOVE,this.mapMouseMoveHandler,!1,this),this.map.un("dblclick",this.mapDoubleClickHandler,this)},P.PlotDraw.prototype.drawEnd=function(t){
this.drawOverlay.remove(this.feature),this.activateMapTools(),this.disconnectEventHandlers(),this.map.removeOverlay(this.drawOverlay),this.points=[],this.plot=null,this.plotType=null,this.plotParams=null,this.dispatchEvent(new P.Event.PlotDrawEvent(P.Event.PlotDrawEvent.DRAW_END,this.feature)),this.feature=null},P.PlotDraw.prototype.deactivateMapTools=function(){for(var t=map.getInteractions(),o=t.getLength(),i=0;o>i;i++){var e=t.item(i);if(e instanceof ol.interaction.DoubleClickZoom){this.dblClickZoomInteraction=e,t.remove(e);break}}},P.PlotDraw.prototype.activateMapTools=function(){null!=this.dblClickZoomInteraction&&(map.getInteractions().push(this.dblClickZoomInteraction),this.dblClickZoomInteraction=null)},P.PlotEdit=function(t){t&&(this.activePlot=null,this.startPoint=null,this.ghostControlPoints=null,this.controlPoints=null,this.map=t,this.mapViewport=this.map.getViewport(),this.mouseOver=!1,this.elementTable={},this.activeControlPointId=null,this.mapDragPan=null)},P.PlotEdit.prototype.Constants={HELPER_HIDDEN_DIV:"p-helper-hidden-div",HELPER_CONTROL_POINT_DIV:"p-helper-control-point-div"},P.PlotEdit.prototype.initHelperDom=function(){if(this.map&&this.activePlot){var t=this.getMapParentElement();if(t)for(var o=P.DomUtils.createHidden("div",t,this.Constants.HELPER_HIDDEN_DIV),i=this.getControlPoints(),e=0;e<i.length;e++){var s=this.Constants.HELPER_CONTROL_POINT_DIV+"-"+e;P.DomUtils.create("div",this.Constants.HELPER_CONTROL_POINT_DIV,o,s),this.elementTable[s]=e}}},P.PlotEdit.prototype.getMapParentElement=function(){var t=this.map.getTargetElement();if(t)return t.parentNode},P.PlotEdit.prototype.destroyHelperDom=function(){if(this.controlPoints){for(var t=0;t<this.controlPoints.length;t++){this.map.removeOverlay(this.controlPoints[t]);var o=P.DomUtils.get(this.Constants.HELPER_CONTROL_POINT_DIV+"-"+t);o&&(P.DomUtils.removeListener(o,"mousedown",this.controlPointMouseDownHandler,this),P.DomUtils.removeListener(o,"mousemove",this.controlPointMouseMoveHandler2,this))}this.controlPoints=null}var i=this.getMapParentElement(),e=P.DomUtils.get(this.Constants.HELPER_HIDDEN_DIV);e&&i&&P.DomUtils.remove(e,i)},P.PlotEdit.prototype.initControlPoints=function(){if(this.map){this.controlPoints=[];for(var t=this.getControlPoints(),o=0;o<t.length;o++){var i=this.Constants.HELPER_CONTROL_POINT_DIV+"-"+o,e=P.DomUtils.get(i),s=new ol.Overlay({id:i,position:t[o],positioning:"center-center",element:e});this.controlPoints.push(s),this.map.addOverlay(s),P.DomUtils.addListener(e,"mousedown",this.controlPointMouseDownHandler,this),P.DomUtils.addListener(e,"mousemove",this.controlPointMouseMoveHandler2,this)}}},P.PlotEdit.prototype.controlPointMouseMoveHandler2=function(t){t.stopImmediatePropagation()},P.PlotEdit.prototype.controlPointMouseDownHandler=function(t){var o=t.target.id;this.activeControlPointId=o,goog.events.listen(this.mapViewport,P.Event.EventType.MOUSEMOVE,this.controlPointMouseMoveHandler,!1,this),goog.events.listen(this.mapViewport,P.Event.EventType.MOUSEUP,this.controlPointMouseUpHandler,!1,this)},P.PlotEdit.prototype.controlPointMouseMoveHandler=function(t){var o=map.getCoordinateFromPixel([t.offsetX,t.offsetY]);if(this.activeControlPointId){var i=this.activePlot.getGeometry(),e=this.elementTable[this.activeControlPointId];i.updatePoint(o,e);var s=this.map.getOverlayById(this.activeControlPointId);s.setPosition(o)}},P.PlotEdit.prototype.controlPointMouseUpHandler=function(t){goog.events.unlisten(this.mapViewport,P.Event.EventType.MOUSEMOVE,this.controlPointMouseMoveHandler,!1,this),goog.events.unlisten(this.mapViewport,P.Event.EventType.MOUSEUP,this.controlPointMouseUpHandler,!1,this)},P.PlotEdit.prototype.activate=function(t){if(t&&t instanceof ol.Feature&&t!=this.activePlot){var o=t.getGeometry();o.isPlot()&&(this.deactivate(),this.activePlot=t,this.map.on("pointermove",this.plotMouseOverOutHandler,this),this.initHelperDom(),this.initControlPoints())}},P.PlotEdit.prototype.getControlPoints=function(){if(!this.activePlot)return[];var t=this.activePlot.getGeometry();return t.getPoints()},P.PlotEdit.prototype.plotMouseOverOutHandler=function(t){var o=map.forEachFeatureAtPixel(t.pixel,function(t,o){return t});o&&o==this.activePlot?this.mouseOver||(this.mouseOver=!0,this.map.getViewport().style.cursor="move",this.map.on("pointerdown",this.plotMouseDownHandler,this)):this.mouseOver&&(this.mouseOver=!1,this.map.getViewport().style.cursor="default",this.map.un("pointerdown",this.plotMouseDownHandler,this))},P.PlotEdit.prototype.plotMouseDownHandler=function(t){this.ghostControlPoints=this.getControlPoints(),this.startPoint=t.coordinate,this.disableMapDragPan(),this.map.on("pointerup",this.plotMouseUpHandler,this),this.map.on("pointerdrag",this.plotMouseMoveHandler,this)},P.PlotEdit.prototype.plotMouseMoveHandler=function(t){for(var o=t.coordinate,i=o[0]-this.startPoint[0],e=o[1]-this.startPoint[1],s=[],n=0;n<this.ghostControlPoints.length;n++){var P=this.ghostControlPoints[n],r=[P[0]+i,P[1]+e];s.push(r);var l=this.Constants.HELPER_CONTROL_POINT_DIV+"-"+n,a=this.map.getOverlayById(l);a.setPosition(r),a.setPositioning("center-center")}var h=this.activePlot.getGeometry();h.setPoints(s)},P.PlotEdit.prototype.plotMouseUpHandler=function(t){this.enableMapDragPan(),this.map.un("pointerup",this.plotMouseUpHandler,this),this.map.un("pointerdrag",this.plotMouseMoveHandler,this)},P.PlotEdit.prototype.disconnectEventHandlers=function(){this.map.un("pointermove",this.plotMouseOverOutHandler,this),goog.events.unlisten(this.mapViewport,P.Event.EventType.MOUSEMOVE,this.controlPointMouseMoveHandler,!1,this),goog.events.unlisten(this.mapViewport,P.Event.EventType.MOUSEUP,this.controlPointMouseUpHandler,!1,this),this.map.un("pointerdown",this.plotMouseDownHandler,this),this.map.un("pointerup",this.plotMouseUpHandler,this),this.map.un("pointerdrag",this.plotMouseMoveHandler,this)},P.PlotEdit.prototype.deactivate=function(){this.activePlot=null,this.mouseOver=!1,this.destroyHelperDom(),this.disconnectEventHandlers(),this.elementTable={},this.activeControlPointId=null,this.startPoint=null},P.PlotEdit.prototype.disableMapDragPan=function(){for(var t=this.map.getInteractions(),o=t.getLength(),i=0;o>i;i++){var e=t.item(i);if(e instanceof ol.interaction.DragPan){this.mapDragPan=e,e.setActive(!1);break}}},P.PlotEdit.prototype.enableMapDragPan=function(){null!=this.mapDragPan&&(this.mapDragPan.setActive(!0),this.mapDragPan=null)};